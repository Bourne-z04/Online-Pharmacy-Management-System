# 百惠康大药房 - 快速启动指南

## 🚀 5分钟快速启动

### 前置要求

- **Java**: JDK 1.8+
- **Maven**: 3.6+
- **MySQL**: 8.0+
- **Redis**: 5.0+
- **微信开发者工具**: 最新版

---

## 第一步：初始化数据库

### 1.1 登录MySQL
```bash
mysql -u root -p
```

### 1.2 执行初始化脚本
```sql
source online_market/backend/src/main/resources/sql/schema.sql
```

或者直接执行：
```bash
mysql -u root -p < online_market/backend/src/main/resources/sql/schema.sql
```

### 1.3 验证数据库
```sql
USE pharmacy_online_market;
SHOW TABLES;
-- 应该看到16张表
```

---

## 第二步：配置后端

### 2.1 修改数据库配置
编辑 `online_market/backend/src/main/resources/application.yml`：

```yaml
spring:
  datasource:
    url: jdbc:mysql://localhost:3306/pharmacy_online_market
    username: root          # 修改为你的MySQL用户名
    password: root          # 修改为你的MySQL密码
```

### 2.2 修改Redis配置
```yaml
spring:
  redis:
    host: localhost         # Redis地址
    port: 6379
    password:               # Redis密码（如果有）
```

### 2.3 其他配置（可选）
```yaml
jwt:
  secret: your-secret-key   # JWT密钥
  expiration: 604800000     # Token有效期（7天）

wechat:
  miniapp:
    app-id: your-appid      # 微信小程序AppID
    secret: your-secret     # 微信小程序Secret
```

---

## 第三步：启动后端服务

### 方式1: 使用Maven
```bash
cd online_market/backend
mvn clean install
mvn spring-boot:run
```

### 方式2: 使用IDE
1. 打开IDEA/Eclipse
2. 导入Maven项目
3. 运行 `OnlineMarketApplication.java`

### 启动成功标志
看到以下输出：
```
========================================
百惠康大药房在线商城后端服务启动成功！
========================================
```

---

## 第四步：测试API

### 4.1 使用浏览器测试
访问：http://localhost:8080/api/category/list

### 4.2 使用Postman测试

#### 测试1: 微信登录
```
POST http://localhost:8080/api/auth/wechat/login
Content-Type: application/json

{
  "code": "test_code",
  "nickname": "测试用户",
  "gender": 1
}
```

**响应示例**:
```json
{
  "code": 200,
  "message": "操作成功",
  "data": {
    "userId": "U1234567890",
    "token": "eyJhbGc...",
    "isFirstLogin": true,
    "agreementAccepted": false
  }
}
```

**重要**: 复制响应中的 `token`，后续请求需要使用！

#### 测试2: 获取商品列表
```
GET http://localhost:8080/api/product/list?page=1&size=20
```

#### 测试3: 添加到购物车（需要Token）
```
POST http://localhost:8080/api/cart
Authorization: Bearer {刚才复制的token}
Content-Type: application/json

{
  "productId": "P12345",
  "quantity": 2
}
```

---

## 第五步：启动微信小程序

### 5.1 安装微信开发者工具
下载地址：https://developers.weixin.qq.com/miniprogram/dev/devtools/download.html

### 5.2 导入项目
1. 打开微信开发者工具
2. 选择"导入项目"
3. 项目目录：选择 `online_market/frontend`
4. AppID：使用测试号或自己的AppID

### 5.3 配置后端地址
编辑 `online_market/frontend/app.js`：
```javascript
globalData: {
  baseUrl: 'http://localhost:8080/api',  // 后端地址
  token: null,
  userInfo: null
}
```

### 5.4 编译运行
1. 在微信开发者工具中点击"编译"
2. 在"详情" -> "本地设置"中，勾选"不校验合法域名"
3. 小程序启动成功！

---

## 🎯 功能验证清单

### ✅ 后端功能验证

1. **登录功能**
   - [ ] 可以成功登录并获得Token
   - [ ] Token可以用于后续请求

2. **商品功能**
   - [ ] 可以获取商品列表
   - [ ] 可以查看商品详情
   - [ ] 可以搜索商品

3. **购物车功能**
   - [ ] 可以添加商品到购物车
   - [ ] 可以查看购物车列表
   - [ ] 可以修改购物车数量

4. **订单功能**
   - [ ] 可以创建订单
   - [ ] 可以查看订单列表
   - [ ] 可以取消订单

5. **地址功能**
   - [ ] 可以添加收货地址
   - [ ] 可以设置默认地址

### ✅ 前端功能验证

1. **小程序启动**
   - [ ] 小程序可以正常启动
   - [ ] 首页可以正常显示

2. **数据加载**
   - [ ] 商品列表可以加载
   - [ ] 图片可以正常显示

---

## ❓ 常见问题

### Q1: 数据库连接失败
**错误**: `Communications link failure`

**解决方案**:
1. 检查MySQL是否已启动
2. 检查 `application.yml` 中的数据库配置
3. 确认用户名密码正确
4. 确认数据库已创建

### Q2: Redis连接失败
**错误**: `Unable to connect to Redis`

**解决方案**:
1. 启动Redis服务
   ```bash
   # Linux/Mac
   redis-server
   
   # Windows
   redis-server.exe
   ```
2. 检查Redis配置

### Q3: 端口被占用
**错误**: `Port 8080 was already in use`

**解决方案**:
修改 `application.yml` 中的端口：
```yaml
server:
  port: 8081  # 改为其他端口
```

### Q4: Maven依赖下载慢
**解决方案**:
配置Maven国内镜像（阿里云）：
```xml
<mirror>
  <id>aliyun</id>
  <mirrorOf>central</mirrorOf>
  <url>https://maven.aliyun.com/repository/public</url>
</mirror>
```

### Q5: 小程序请求失败
**错误**: `request:fail`

**解决方案**:
1. 确认后端已启动
2. 检查 `app.js` 中的 `baseUrl`
3. 在微信开发者工具中勾选"不校验合法域名"

---

## 📝 测试数据说明

### 默认数据
系统启动后，数据库是空的，需要手动添加测试数据。

### 添加测试商品
```sql
-- 插入分类
INSERT INTO category (category_name, parent_id, sort_order, status) 
VALUES ('感冒药', 0, 1, 1);

-- 插入商品
INSERT INTO product (product_id, product_name, category_id, price, main_image, status) 
VALUES ('P12345', '999感冒灵', 1, 15.80, '/images/product1.jpg', 1);

-- 插入库存
INSERT INTO inventory (product_id, available_stock, total_stock) 
VALUES ('P12345', 100, 100);
```

---

## 🔧 开发工具推荐

### 后端开发
- **IDE**: IntelliJ IDEA / Eclipse
- **API测试**: Postman / Apifox
- **数据库工具**: Navicat / DBeaver
- **Redis工具**: RedisDesktopManager

### 前端开发
- **微信开发者工具**: 官方工具
- **代码编辑**: VSCode（可选）

---

## 📚 下一步学习

### 1. 补充测试数据
向数据库添加更多商品、分类等测试数据

### 2. 完善前端页面
参考 `pages/index` 实现其他页面

### 3. 集成微信支付
配置微信支付参数，实现真实支付流程

### 4. 开发B端系统
搭建Vue管理后台，实现商品和订单管理

---

## 💡 开发建议

### 1. 日志查看
后端日志位置：`logs/online-market.log`

### 2. 调试技巧
- 使用IDEA的Debug模式
- 在关键位置添加日志
- 使用Postman测试接口

### 3. 代码规范
- 遵循阿里巴巴Java开发规范
- 统一使用Lombok简化代码
- 添加必要的注释

---

## 🎓 技术文档

详细技术文档请查看 `documents` 目录：

1. **开发进度报告.md** - 查看开发进度
2. **技术实现指南.md** - 技术实现参考
3. **项目交付总结.md** - 完整功能清单

---

## 📞 获取帮助

遇到问题时：
1. 查看错误日志
2. 检查配置文件
3. 参考文档说明
4. 查看代码注释

---

**祝您使用愉快！ 🎉**

如有问题，请及时反馈。

---
**百惠康大药房 © 2024**

