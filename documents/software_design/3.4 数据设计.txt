数据设计
1. 核心持久化数据
系统需持久保存五类核心业务实体：
用户实体：包含C端用户全局ID、微信OpenID、基础信息、收货地址、实名认证状态；B端工作人员工号、密码哈希、角色权限。地址独立存储，支持20条上限与默认标记。
商品实体：包括商品ID、名称、规格、批准文号、价格、可用库存、冻结库存、上下架状态、处方药标识。库存数据独立设表，记录变更流水。
订单实体：包括订单号、用户ID、订单类型、状态、商品清单、地址快照、支付方式、支付流水号、应付与实付金额、配送方式、处方ID。明细独立存储。
处方实体：包括处方ID、订单ID、患者姓名、身份证号、疾病信息、体重、复诊凭证、医生ID、处方图片、药师审核意见、审核状态。敏感信息加密存储。
售后实体：包括售后单号、订单号、申请类型、原因、凭证、处理状态、退款单号。
辅助实体包括购物车、物流轨迹、统计报表、操作日志、隐私协议授权记录。
2. 存储组织方式
采用MySQL 8.0主库，InnoDB引擎，严格SQL模式。大文件采用分布式对象存储，数据库存路径与哈希。
遵循第三范式，订单地址等高频查询场景允许反范式冗余。所有表含创建时间、更新时间、逻辑删除标志，禁物理删除。
订单表按创建时间RANGE分区，每月一分区。日志表按周分区，自动清理90天前数据。
索引覆盖高频查询列与组合条件：用户ID、订单号、商品ID、处方ID建聚簇或唯一索引；订单表建用户ID+状态+创建时间复合索引；商品表建分类+上架状态+价格复合索引；商品名称等建FULLTEXT索引。
3. 数据操作规范
创建：通过连接池执行，批量插入用JDBC批处理。订单创建用事务包裹，确保主表与明细原子写入。
读取：优先主键或索引查询，禁全表扫描。分页用延迟关联优化。商品信息、分类用Redis缓存，TTL 5分钟。
更新：库存扣减用乐观锁，版本号控制并发。UPDATE必须带索引条件。敏感信息更新记录日志。
删除：统一逻辑删除，DELETE仅更新标志。关联删除需校验业务状态。
事务管理：订单创建、库存锁定、支付流水号生成置于同一事务，超时未支付回滚释放库存，隔离级别READ COMMITTED。处方审核三操作拆为独立事务，状态机保证最终一致。售后退款用TCC模式。
并发控制：库存扣减用UPDATE ... WHERE available_stock >= quantity AND version = ?，重试3次失败返回"库存不足"。地址上限在应用层校验。支付流水号建唯一索引防重复。