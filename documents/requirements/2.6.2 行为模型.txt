状态-迁移图（待转换为 Graphviz、PlantUML、UML 状态图绘制版本）

状态：
状态1：用户发起业务流程

活动表：初始化用户环境；等待用户进入购药或问诊链路

状态2：订单创建中

活动表：校验商品与库存；生成订单草稿

状态3：待提交患者信息

活动表：填写身份信息、病情描述；上传复诊证明

状态4：审核中

活动表：医生审核材料；显示排队等待时间

状态5：已开方

活动表：生成处方内容；进入结算链路

状态6：待支付

状态变量：pay_timer=0
活动表：生成支付流水号；锁定库存；启动支付倒计时

状态7：待发货

活动表：商家备货；可触发即时配送

状态8：配送中

活动表：推送至配送平台；更新配送轨迹

状态9：已收货

活动表：等待用户确认收货或自动确认；可发起售后

状态10：售后待审核

活动表：用户填写售后原因；上传凭证；等待商家审核

状态11：售后处理中

活动表：平台/微信退款处理；退货则等待用户寄回包裹

状态12：售后异常

活动表：退款失败；需人工介入或重新申请

状态终1：订单取消

活动表：记录取消原因；释放库存

状态终2：订单关闭

活动表：因超时或缺货终止流程

状态终3：订单已完成

活动表：订单闭环；可发起评价

状态终4：处方审核失败

活动表：显示失败原因；允许用户重新提交

状态终5：售后拒绝

活动表：商家拒绝售后；记录原因

状态终6：退款成功

活动表：售后闭环；退款到账
事件：
事件1：用户进入购药链路

状态转换：从 状态1 到 状态2

事件2：用户进入问诊链路

状态转换：从 状态1 到 状态3

事件3：用户提交订单

状态转换：从 状态2 到 状态6

事件4：用户取消订单

状态转换：从 状态2 到 状态终1
状态转换：从 状态6 到 状态终1

事件5：支付成功

状态转换：从 状态6 到 状态7

事件6：支付超时

状态转换：从 状态6 到 状态终2

事件7：商家点击发货

状态转换：从 状态7 到 状态8

事件8：商家拒绝发货（缺货）

状态转换：从 状态7 到 状态终2

事件9：骑手送达

状态转换：从 状态8 到 状态9

事件10：用户确认收货

状态转换：从 状态9 到 状态终3

事件11：系统自动确认（超时）

状态转换：从 状态9 到 状态终3

事件12：用户申请售后

状态转换：从 状态9 到 状态10

事件13：用户提交问诊信息

状态转换：从 状态3 到 状态4

事件14：审核通过

状态转换：从 状态4 到 状态5

事件15：审核拒绝

状态转换：从 状态4 到 状态终4

事件16：审核超时

状态转换：从 状态4 到 状态终4

事件17：用户点击支付（处方链路）

状态转换：从 状态5 到 状态6

事件18：商家同意售后

状态转换：从 状态10 到 状态11

事件19：商家拒绝售后

状态转换：从 状态10 到 状态终5

事件20：商家超时未处理

状态转换：从 状态10 到 状态11

事件21：退款成功

状态转换：从 状态11 到 状态终6

事件22：退款失败

状态转换：从 状态11 到 状态12