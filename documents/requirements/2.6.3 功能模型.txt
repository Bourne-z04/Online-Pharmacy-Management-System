数据流图、数据字典

数据流图：
一、外部实体（External Entities）

E1：C端用户
描述：通过微信小程序使用购药、支付、物流、处方上传、售后等功能。

E2：B端药店工作人员
描述：在后台管理系统进行商品管理、订单处理、库存操作、售后处理、处方审核等业务。

E3：第三方支付平台
描述：微信支付平台，用于订单支付、退款处理等。

E4：互联网医院
描述：对用户上传的患者信息、处方材料进行审核与开方。

E5：物流配送平台
描述：即时配送骑手取件、更新配送轨迹。

二、数据流（Data Flows）
F1：商品浏览请求

描述：用户请求查看商品列表、分类、搜索结果。
流向：从 E1 到 C1

F2：商品信息列表

描述：系统返回商品展示数据。
流向：从 C1 到 E1

F3：提交订单数据

描述：用户选择商品并提交订单草稿（商品ID、数量、地址等）。
流向：从 E1 到 C2

F4：订单草稿

描述：系统校验库存并返回可支付订单草稿。
流向：从 C2 到 E1

F5：患者信息与材料

描述：用户上传实名信息、病情描述、复诊证明。
流向：从 E1 到 C3

F6：审核材料转发

描述：系统将用户材料转发给医生审核服务。
流向：从 C3 到 E4

F7：审核结果/处方

描述：医生返回审核状态（通过/拒绝）以及处方内容。
流向：从 E4 到 C4

F8：处方推送给用户

描述：系统将处方展示给用户并进入支付链路。
流向：从 C4 到 E1

F9：支付请求

描述：系统发起支付（订单号、金额）。
流向：从 C5 到 E3

F10：支付结果通知

描述：支付成功 / 失败 / 超时。
流向：从 E3 到 C5

F11：发货指令

描述：商家通知系统订单已发货。
流向：从 E2 到 C6

F12：配送任务推送

描述：系统创建配送单并推送到配送平台。
流向：从 C6 到 E5

F13：配送状态更新

描述：配送平台返回骑手轨迹、送达状态。
流向：从 E5 到 C6

F14：物流信息展示

描述：系统返回物流轨迹给用户。
流向：从 C6 到 E1

F15：售后申请

描述：用户填写退货退款申请与凭证。
流向：从 E1 到 C7

F16：售后审核结果

描述：商家同意、拒绝或超时处理。
流向：从 E2 到 C7

F17：退款结果

描述：支付平台返回退款成功/失败。
流向：从 E3 到 C7

F18：售后状态推送

描述：系统将处理结果返回用户。
流向：从 C7 到 E1

三、数据变换（Processing / Transformations）
C1：商品信息浏览

功能：查询商品列表、分类、详情，返回用户可视数据。

C2：订单创建与校验

功能：校验库存、生成订单草稿、写入订单数据存储。

C3：患者信息处理

功能：接收患者材料，校验格式并转发给医生服务。

C4：处方审核处理

功能：接收审核结果、存储处方、进入订单支付链路。

C5：支付处理

功能：调用支付平台；接收支付回调；更新订单状态。

C6：物流与配送管理

功能：商家发货、生成配送单、推送配送平台、接收轨迹更新。

C7：售后处理

功能：商家审核售后、发起退款、处理退款失败逻辑。

四、数据存储（Data Stores）
S1：用户数据存储

内容：用户个人信息、实名信息、历史地址、认证状态。

S2：商品数据存储

内容：商品信息、库存、价格、分类。

S3：订单数据存储

内容：订单草稿、订单正式记录、支付状态、物流信息。

S4：患者信息与处方存储

内容：上传证件、病情描述、审核记录、处方内容。

S5：售后数据存储

内容：售后申请、审核结果、退款单号、退款记录。

数据字典：
一、外部实体定义（External Entity）
E1 用户（C 端消费者）

编号：E1

描述：系统服务的最终消费者，在小程序端进行注册、登录、下单、支付等操作。

定义：用户=用户基本信息+账户状态

用户基本信息=用户ID+姓名+手机号+实名信息

账户状态=账户有效性+认证状态

E2 药店工作人员（B 端）

编号：E2

描述：负责商品管理、订单处理、处方审核。

定义：工作人员=工号+姓名+角色权限

E3 支付平台

编号：E3

描述：第三方微信支付平台，负责支付扣款及回调。

定义：支付平台事件=支付请求+支付回调结果

E4 物流服务商

编号：E4

描述：负责订单包裹的配送与状态更新。

定义：物流状态=揽收+运输+派送+签收

二、数据流定义（Data Flow）
F1 用户注册信息流

编号：F1

描述：用户提交注册所需信息。

来源：E1 用户

去向：C1 用户注册处理

结构：手机号+验证码+密码

F2 登录凭证流

编号：F2

描述：用户登录系统的凭证。

来源：E1

去向：C2 登录验证处理

结构：手机号+密码

F3 商品浏览请求流

编号：F3

描述：用户浏览商品列表或详情的请求。

来源：E1

去向：C3 商品查询处理

结构：分类ID+关键字+排序方式

F4 订单信息流

编号：F4

描述：用户生成订单所提交的数据。

来源：E1

去向：C4 订单生成处理

结构：商品项列表+地址ID+支付方式+处方ID

F5 支付请求流

编号：F5

描述：系统向支付平台发送的支付请求。

来源：C4

去向：E3 支付平台

结构：订单号+金额+支付参数

F6 支付回调流

编号：F6

描述：支付平台回传的支付结果。

来源：E3

去向：C5 支付确认处理

结构：订单号+支付状态

F7 物流状态流

编号：F7

描述：物流服务商返回订单的配送进度。

来源：E4

去向：C6 物流状态更新

结构：物流单号+状态+时间

F8 处方上传数据流

编号：F8

描述：用户上传处方图片或电子处方信息。

来源：E1

去向：C7 处方审核处理

结构：处方照片+用户ID

三、数据存储定义（Data Store）
S1 用户信息库

编号：S1

描述：存储用户账号、身份信息及状态。

定义：用户信息=用户ID+手机号+密码Hash+实名信息+认证状态

S2 商品信息库

编号：S2

描述：保存所有商品的静态与动态信息。

定义：商品=商品ID+名称+价格+规格+库存+上架状态

S3 订单信息库

编号：S3

描述：记录用户订单及订单状态。

定义：订单=订单号+用户ID+订单明细+金额+支付状态+物流状态

S4 处方信息库

编号：S4

描述：保存用户处方上传记录。

定义：处方=处方ID+用户ID+图片+审核结果+药师ID

S5 库存信息库

编号：S5

描述：商品库存数量及变动记录。

定义：库存项=商品ID+可用库存+冻结库存

四、数据加工定义（Process）
C1 用户注册处理

编号：C1

输入：F1 用户注册信息流

加工说明：校验手机号格式、验证码正确性，生成用户ID。

输出：用户信息→S1

C2 用户登录验证

编号：C2

输入：F2 登录凭证流

加工说明：验证密码Hash是否一致，生成会话Token。

输出：登录结果+Token

C3 商品查询处理

编号：C3

输入：F3 商品浏览请求流

加工说明：根据分类或关键字搜索 S2 商品信息库。

输出：商品列表

C4 订单生成处理

编号：C4

输入：F4 订单信息流

加工说明：校验库存、生成订单、写入 S3，并请求支付。

输出：F5 支付请求流

C5 支付确认处理

编号：C5

输入：F6 支付回调流

加工说明：更新支付状态、触发库存扣减与物流创建。

输出：订单支付状态更新→S3，库存更新→S5

C6 物流状态更新

编号：C6

输入：F7 物流状态流

加工说明：写入订单物流状态，通知用户。

输出：物流更新→S3

C7 处方审核处理

编号：C7

输入：F8 处方上传数据流

加工说明：药师审核处方合法性

输出：处方审核结果→S4

