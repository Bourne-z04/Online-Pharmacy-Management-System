2.2 功能需求分析

1.登录注册模块
	系统应为C端用户提供微信快捷登录服务，为B端用户提供账号注册、登录及密码管理服务。

1.1 隐私保护协议确认（C端）	
	系统需在小程序启动和登录时向用户展示隐私保护协议并获取明确同意。当用户点击"同意"或勾选协议框时，系统记录授权状态并允许后续操作；若用户拒绝或未勾选，系统拒绝调用隐私接口和登录请求。输出内容为隐私保护提示模态框或"请先阅读并同意《用户隐私协议》"的确认提示。系统不得在未经用户明确同意的情况下调用任何隐私相关接口或允许登录。

1.2 微信快捷登录（C端）
	系统提供基于微信授权的快捷登录机制，首次登录时自动为用户生成全局唯一用户ID并与微信OpenID绑定。当未登录用户访问个人中心等受限页面时，系统强制弹出登录页阻断操作。输出内容为登录成功后的用户身份凭证或登录页面拦截。系统不得允许未授权用户绕过登录流程访问需鉴权功能。

1.3 非登录态权限隔离（C端）
	系统对未登录用户实施严格的功能访问限制，仅开放商品浏览权限。当非登录用户尝试访问购物车、订单管理等接口时，系统返回401未授权状态码。输出内容为商品列表/详情页或401状态拒绝响应。系统不得向未登录用户返回任何受保护的用户数据或功能入口。

1.4 账号注册（B端）
	系统提供账号密码注册入口并强制校验账号唯一性。当用户提交注册信息时，系统检查账号是否存在，若冲突则阻断注册。输出内容为注册成功页或"账号已存在"错误提示。系统不得允许重复注册已存在的账号。

1.5 账号登录（B端）
	系统验证B端用户账号与密码的匹配性以授予访问权限。当用户输入登录凭证时，系统比对密码准确性，错误允许重试。输出内容为登录成功后的工作台页面或"密码错误"明确提示。系统不得对密码错误的情况返回模糊提示或允许暴力破解。

1.6 密码修改（B端）
	系统提供密码修改功能并强制验证原密码正确性。当用户提交新密码时，系统校验原密码通过后才接受修改。输出内容为密码修改成功确认或原密码验证失败提示。系统不得在未验证原密码的情况下允许设置新密码。

2.个人中心模块
	系统需为C端用户提供个人资料管理功能。

2.1 个人中心主界面	
	系统展示用户头像、昵称及"我的订单"等核心功能模块。当用户点击"退出登录"时，系统弹出二次确认窗口询问"确认退出登录？"。输出内容为个人中心主界面或确认退出对话框。

2.2 信息编辑
	系统支持用户修改昵称、性别、生日及收货地址等个人资料。当用户输入昵称时，系统实时校验2-20字符长度并仅允许汉字、字母、数字；选择生日时限制范围在1900-01-01至当前日期。输出内容为保存成功的个人信息或"昵称包含非法字符"等实时错误提示。系统不得保存包含非法字符或超出范围的昵称与生日信息。

2.3 头像上传
	系统支持拍照或相册选择方式上传头像，并自动将图片缩放至200×200像素。当用户选择图片时，系统校验JPG/PNG格式及2MB大小限制，上传过程中检测网络状态。输出内容为上传成功的头像预览或"图片过大，请选择2MB以内的图片"/"头像上传失败，请检查网络后重试"等提示。系统不得接收超过2MB或格式不符的图片，网络中断时不得静默失败。

2.4 收货地址管理
	系统管理用户收货地址并限制列表上限为20条，支持新增、编辑与默认地址设置。当用户操作地址时，系统校验详细地址5-100字符长度且门牌号必填，达到上限后阻断新增。输出内容为显示脱敏手机号和前3后4位的地址列表，或"地址数量已达上限，请删除无用地址后再添加"提示。系统不得在地址满20条后允许新增，不得保存不含门牌号的地址。

3.商品浏览模块
	系统需为C端用户提供商品浏览功能。

3.1 分类导航与列表展示
	系统在左侧展示药品分类导航栏，商品列表采用每页20个卡片的分页加载机制。当用户下滑至底部时，自动触发下一页加载并显示骨架屏动画；点击处方药卡片时系统加载详情。输出内容为商品卡片列表（处方药标注警示标签）或"加载失败，请检查网络"占位图。系统不得展示处方药的包装图片。

3.2 智能搜索
	搜索框支持药品名称、适应症或成分的模糊匹配与拼音联想，并保存历史搜索记录。当用户输入关键词时，系统1秒内返回结果；结果为空时自动推荐3-5个同类热销商品。输出内容为搜索建议列表或搜索结果页。系统不得在搜索超时后无响应，无结果时不得显示空白页面。

3.3 详情页内容展示
	商品详情页分模块展示标题、价格、图片轮播及规格参数完整信息。当用户点击商品卡片时，系统加载详情；若商品已下架则接口返回404状态。输出内容为正常详情页或"商品已下架"独立页面；文本超长时显示"展开全部"链接。系统不得对下架商品展示原详情页，图片加载失败时不得留空。

3.4 详情页导航栏
	导航栏固定展示"首页、客服、加入购物车、在线购买/立即问诊"四项功能入口。当非登录用户点击除"首页"外按钮时，系统拦截并跳转登录页；点击"客服"显示药店电话。输出内容为对应功能页面或药店联系电话弹窗。

3.5 订单发起
	系统支持用户选择购买数量并实时校验库存与商品有效性。当用户修改数量时，系统限制范围为1-99件，超过库存自动调整并标红提示；检测到商品下架自动移除。输出内容为有效的购买数量或"已调整至最大可购买数量X件"/"以下商品已失效"等提示。

4.购物车管理模块
	系统需为登录后的C端用户提供购物车功能。

4.1 购物车商品展示与数量修改
	系统为登录用户提供购物车数据持久化存储，确保数据长期不丢失。当用户修改数量或商品状态变更时，系统实时计算总价并同步更新；处方药自动标注"需处方审核"。输出内容为含状态标签的商品列表与应付金额。

4.2 批量管理
	系统支持用户对购物车商品进行批量选择与删除操作。当用户点击"批量删除"时，系统检查是否已勾选商品，未勾选则阻断操作。输出内容为删除成功的商品列表或"请先选择商品"提示。

4.3 结算跳转
	系统根据购物车内容动态切换结算按钮为"去结算"或"去开方"。当用户点击按钮时，系统识别商品类型并跳转至订单结算页或开方流程。输出内容为订单结算页面。系统不得对含处方药的购物车显示普通"去结算"按钮。

5.订单结算模块
	系统需为登录后的C端用户提供订单结算功能。
	
5.1 商品清单展示
	结算页顶部清晰展示用户拟购买的所有商品明细。当用户进入页面时，系统加载并展示商品缩略图、名称、规格、单价及数量。输出内容为完整的商品清单信息。系统不得漏显或错显用户已选商品。

5.2 收货地址管理
	系统默认选中用户设置的默认地址，若无则选择最常用地址。当用户地址列表为空时，系统强制跳转至地址管理页阻断结算。输出内容为选中的收货地址信息或地址管理页。系统不得在无有效地址时允许进入支付环节。

5.3 配送方式选择
	系统提供"骑手配送"与"到店自提"两种配送方式并强制二选一。当用户选择时，系统提供时段选择或门店列表（停业门店置灰）。输出内容为配送时段选项或可来自提门店列表。

5.4 金额计算与展示
	系统实时计算应付金额并分项展示商品总价、运费、优惠等明细。当商品数量或配送方式变更时，系统自动重算并更新展示。输出内容为明细化的金额计算结果。

5.5 支付流程控制
	用户点击"立即支付"后，系统唤起微信支付并生成唯一支付流水号锁定库存。当支付超2小时未成功时，系统自动关闭订单并释放库存，每秒轮询支付状态。输出内容为订单详情页或"支付超时，订单已关闭"/"支付未完成"提示。系统不得允许同一订单多次支付成功，不得对已支付订单重复扣款。

5.6 订单取消
	"待支付"订单详情页提供"取消订单"按钮并弹出二次确认。当用户确认取消时，系统校验订单状态，若已支付或已发货则阻断操作。输出内容为取消成功或"当前订单状态不支持取消，请联系商家处理"提示。

6.处方审核模块
	系统需为登录后的C端用户提供互联网医院在线问诊功能。
	
6.1 患者信息采集
	系统要求用户添加真实姓名、身份证号、疾病信息等患者资料并上传复诊凭证。当用户提交信息时，系统校验体重范围(1-300kg)、图片数量(最多5张)及大小(单张≤5MB)，强制同意《互联网医院问诊协议》。输出内容为提交成功或"请输入有效体重"等错误提示。系统不得在未获取协议同意或信息不完整时允许提交。

6.2 在线问诊与处方开具
	系统智能匹配科室医生，提供10分钟在线图文问诊并自动保存记录。当医生离线时，系统显示预计等待时间并排队，超10分钟提示超时；问诊结束后医生需在5分钟内开具处方，超时自动关闭。输出内容为聊天记录、处方图片或审核意见。

7.订单查询模块
	系统需为登录后的C端用户提供全生命周期订单查询功能。
	
7.1  订单筛选与展示
	系统支持按“待支付、待收货、已完成、售后”4种状态筛选订单，列表按时间倒序展示脱敏订单号、商品主图、名称、实付金额及差异化操作按钮。当用户选择筛选条件时，系统加载对应状态订单并配置可操作按钮（如待支付显示"去支付"/"取消订单"）。输出内容为订单缩略列表及状态标签。

7.2 订单详情展示
	订单详情页完整展示订单信息、收货人脱敏信息、商品清单、费用明细、支付流水号及收货状态。当用户点击订单时，系统加载详情；处方药订单额外展示处方图片缩略图及药师审核意见。输出内容为完整的订单详情数据。

8.订单售后模块
	系统为"待收货"与"已完成"状态订单提供退货申请入口。当用户提交申请时，系统校验订单状态、上传凭证(最多3张，单张≤5MB)及原因，商家需在48小时内处理否则自动同意。输出内容为售后状态订单或处理结果。
			
9.物流查询模块
	系统通过微信即时配送接口同步顺丰同城、美团等配送平台状态。当骑手接单、取货、配送等节点变更时，系统接收回调并每30秒轮询，向用户推送微信服务通知。输出内容为配送进度详情及节点通知。

10.商品管理模块
	系统为B端用户提供商品增删改查及状态机管理功能。当用户执行上架操作时，系统校验主图、详情图、价格等必填项完整性，自动对接医药管理系统填充核心属性。输出内容为商品操作成功确认或"商品信息不完整"阻断提示。系统不得允许手动修改与医药管理系统同步的核心属性与库存，已删除商品超30天不得恢复。
	
11.订单处理模块
	系统需为登录的B端用户提供订单分状态处理工作台。

11.1 订单筛选与展示
	系统支持按"待发货、待收货、已完成、售后"4种状态分类展示订单。当用户设置筛选条件时，系统加载匹配订单列表并按时间倒序排列。输出内容为显示订单号、用户信息、商品数量、实付金额的订单列表。

11.2 发货
	待发货订单提供"立即发货"按钮，选择"第三方骑手"时自动调用微信即时配送API推送。当API推送失败时，系统提示"配送平台对接失败，请重试或联系客服"。输出内容为配送平台回执及骑手姓名、手机号、配送进度。

11.3 退货退款处理
	用户提交退货申请后，订单流转至B端售后工作台。当商家操作售后订单时，系统支持"同意"或"拒绝"（拒绝必须填写原因），超时48小时自动同意。输出内容为处理结果及拒绝原因。
12.销售统计分析模块	
	系统为登录的B端用户提供统计查询与数据分析功能。

12.1 各类销售统计报表生成
	系统生成日报/周报/月报/年报，包含销售额、订单量、客单价、退单率等指标。当用户自定义时间范围查询时，系统计算并支持导出Excel/PDF格式，保留1年导出记录。输出内容为可视化报表文件。

12.2 销售员业绩统计
	系统按B端账号统计销售额、订单量、客单价并生成日/周/月/年排行榜，前三名特殊标识。当用户查询业绩时，系统根据预设提成规则自动计算提成金额。输出内容为业绩数据及排行榜。

12.3 商品销售统计
	系统提供单品销量TOP100排行榜及类别占比饼状图/柱状图可视化。当用户筛选类别、品牌或时间段时，系统重新计算并展示统计结果。输出内容为排序后的商品列表及可视化图表。

	
	
	